(()=>{"use strict";var t={538:(t,e,a)=>{a.d(e,{A:()=>o});var n=a(601),r=a.n(n),i=a(314),s=a.n(i)()(r());s.push([t.id,"",""]);const o=s},197:(t,e,a)=>{a.d(e,{A:()=>o});var n=a(601),r=a.n(n),i=a(314),s=a.n(i)()(r());s.push([t.id,"",""]);const o=s},833:(t,e,a)=>{a.d(e,{A:()=>o});var n=a(601),r=a.n(n),i=a(314),s=a.n(i)()(r());s.push([t.id,"",""]);const o=s},3:(t,e,a)=>{a.d(e,{A:()=>o});var n=a(601),r=a.n(n),i=a(314),s=a.n(i)()(r());s.push([t.id,"",""]);const o=s},809:(t,e,a)=>{a.d(e,{A:()=>o});var n=a(601),r=a.n(n),i=a(314),s=a.n(i)()(r());s.push([t.id,"",""]);const o=s},623:(t,e,a)=>{a.d(e,{A:()=>o});var n=a(601),r=a.n(n),i=a(314),s=a.n(i)()(r());s.push([t.id,"",""]);const o=s},218:(t,e,a)=>{a.d(e,{A:()=>o});var n=a(601),r=a.n(n),i=a(314),s=a.n(i)()(r());s.push([t.id,"",""]);const o=s},338:(t,e,a)=>{a.d(e,{A:()=>o});var n=a(601),r=a.n(n),i=a(314),s=a.n(i)()(r());s.push([t.id,"",""]);const o=s},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var a="",n=void 0!==e[5];return e[4]&&(a+="@supports (".concat(e[4],") {")),e[2]&&(a+="@media ".concat(e[2]," {")),n&&(a+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),a+=t(e),n&&(a+="}"),e[2]&&(a+="}"),e[4]&&(a+="}"),a})).join("")},e.i=function(t,a,n,r,i){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(n)for(var o=0;o<this.length;o++){var c=this[o][0];null!=c&&(s[c]=!0)}for(var l=0;l<t.length;l++){var d=[].concat(t[l]);n&&s[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),a&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=a):d[2]=a),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),e.push(d))}},e}},601:t=>{t.exports=function(t){return t[1]}},385:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),e.hash&&(t+=e.hash),e.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(t)?'"'.concat(t,'"'):t):t}},72:t=>{var e=[];function a(t){for(var a=-1,n=0;n<e.length;n++)if(e[n].identifier===t){a=n;break}return a}function n(t,n){for(var i={},s=[],o=0;o<t.length;o++){var c=t[o],l=n.base?c[0]+n.base:c[0],d=i[l]||0,h="".concat(l," ").concat(d);i[l]=d+1;var u=a(h),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)e[u].references++,e[u].updater(m);else{var p=r(m,n);n.byIndex=o,e.splice(o,0,{identifier:h,updater:p,references:1})}s.push(h)}return s}function r(t,e){var a=e.domAPI(e);return a.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;a.update(t=e)}else a.remove()}}t.exports=function(t,r){var i=n(t=t||[],r=r||{});return function(t){t=t||[];for(var s=0;s<i.length;s++){var o=a(i[s]);e[o].references--}for(var c=n(t,r),l=0;l<i.length;l++){var d=a(i[l]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}i=c}}},659:t=>{var e={};t.exports=function(t,a){var n=function(t){if(void 0===e[t]){var a=document.querySelector(t);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(t){a=null}e[t]=a}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(a)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,a)=>{t.exports=function(t){var e=a.nc;e&&t.setAttribute("nonce",e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(a){!function(t,e,a){var n="";a.supports&&(n+="@supports (".concat(a.supports,") {")),a.media&&(n+="@media ".concat(a.media," {"));var r=void 0!==a.layer;r&&(n+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),n+=a.css,r&&(n+="}"),a.media&&(n+="}"),a.supports&&(n+="}");var i=a.sourceMap;i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,a)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},467:(t,e,a)=>{t.exports=a.p+"cd7716048ffbda0235e6.ts"}},e={};function a(n){var r=e[n];if(void 0!==r)return r.exports;var i=e[n]={id:n,exports:{}};return t[n](i,i.exports,a),i.exports}a.m=t,a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t})(),a.b=document.baseURI||self.location.href,a.nc=void 0,(()=>{var t=a(385),e=a.n(t),n=new URL(a(467),a.b);e()(n);var r=a(72),i=a.n(r),s=a(825),o=a.n(s),c=a(659),l=a.n(c),d=a(56),h=a.n(d),u=a(540),m=a.n(u),p=a(113),g=a.n(p),w=a(538),b={};b.styleTagTransform=g(),b.setAttributes=h(),b.insert=l().bind(null,"head"),b.domAPI=o(),b.insertStyleElement=m(),i()(w.A,b),w.A&&w.A.locals&&w.A.locals;var f=a(338),v={};v.styleTagTransform=g(),v.setAttributes=h(),v.insert=l().bind(null,"head"),v.domAPI=o(),v.insertStyleElement=m(),i()(f.A,v),f.A&&f.A.locals&&f.A.locals;var y=a(218),C={};C.styleTagTransform=g(),C.setAttributes=h(),C.insert=l().bind(null,"head"),C.domAPI=o(),C.insertStyleElement=m(),i()(y.A,C),y.A&&y.A.locals&&y.A.locals;var A=a(809),E={};E.styleTagTransform=g(),E.setAttributes=h(),E.insert=l().bind(null,"head"),E.domAPI=o(),E.insertStyleElement=m(),i()(A.A,E),A.A&&A.A.locals&&A.A.locals;const S=class{constructor({tagName:t="div",className:e="",textContent:a="",attributes:n={}},...r){this.children=[];const i=document.createElement(t);i.className=e,i.textContent=a,this.elem=i,n&&this.setAttributes(n),r&&this.appendChildren(r)}setTextContent(t){this.elem.textContent=t}getTextContent(){return this.elem.textContent?this.elem.textContent:(console.error("no text content"),"")}deleteAttribute(t){this.elem.removeAttribute(t)}setAttributes(t){t&&this.elem&&Object.keys(t).forEach((e=>{const a=t[e];"boolean"==typeof a?this.elem.setAttribute(e,""):this.elem.setAttribute(e,a)}))}appendChildren(t){t.forEach((t=>this.append(t)))}append(t){this.children.push(t),this.elem?.append(t.getElement())}getElement(){return this.elem}addListener(t,e,a=!1){this.elem.addEventListener(t,e,a)}removeListener(t,e,a=!1){this.elem.removeEventListener(t,e,a)}deleteChildren(){this.children.forEach((t=>{t.delete()})),this.children.length=0}deleteChild(t){const e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.elem.remove())}getAllChildrenMap(){const t=new Map,e=a=>{const n=a.elem.className.split(" ")[0];t.set(n,a),a.children.forEach((t=>e(t)))};return this.children.forEach((t=>e(t))),t}delete(){this.deleteChildren(),this.elem.remove()}addStyle(t){const e=this.elem.style;Object.keys(t).forEach((a=>{e.setProperty(a,t[a])}))}getWidth(){return this.elem.clientWidth}toggleClass(t){this.elem.classList.toggle(t)}},T=class extends S{constructor({className:t,textContent:e,clickHandler:a}){super({tagName:"button",className:`${t} button`,textContent:e}),this.clickHandler=a??(()=>{}),this.addListener("click",this.clickHandler)}delete(){this.clickHandler&&this.removeListener("click",this.clickHandler),super.delete()}};var N=a(623),x={};x.styleTagTransform=g(),x.setAttributes=h(),x.insert=l().bind(null,"head"),x.domAPI=o(),x.insertStyleElement=m(),i()(N.A,x),N.A&&N.A.locals&&N.A.locals;const R=class extends S{constructor({className:t,id:e="",type:a="",placeholder:n=""}){super({tagName:"input",className:`${t} input`,attributes:{id:e,type:a,placeholder:n}})}getValue(){return this.getElement().value}},P=(t,...e)=>new S({tagName:"div",className:t},...e),I=(t,e)=>new S({tagName:"p",className:t,textContent:e}),M=(t,e)=>new S({tagName:"h1",className:t,textContent:e}),W=(t,e,a)=>new T({className:t,textContent:e,clickHandler:a}),$=(t,e,a="",n="")=>new R({className:t,id:n,type:e,placeholder:a}),L=(t,...e)=>new S({tagName:"tr",className:t},...e),j=(t,e,a)=>new S({tagName:"th",attributes:{scope:a},className:t,textContent:e}),V=(t,e,...a)=>new S({tagName:"td",className:t,textContent:e},...a);var k=a(833),_={};_.styleTagTransform=g(),_.setAttributes=h(),_.insert=l().bind(null,"head"),_.domAPI=o(),_.insertStyleElement=m(),i()(k.A,_),k.A&&k.A.locals&&k.A.locals;var O=a(197),H={};H.styleTagTransform=g(),H.setAttributes=h(),H.insert=l().bind(null,"head"),H.domAPI=o(),H.insertStyleElement=m(),i()(O.A,H),O.A&&O.A.locals&&O.A.locals;const G=a.p+"804bb78e7192b0228d6c.svg",F=a.p+"9647b73bcdc510635476.svg",B=class{static async loadGarageData(){const t=await fetch("http://127.0.0.1:3000/garage");if(!t.ok)throw new Error("Failed to fetch garage");return t.json()}static async addCar(t,e){const a=await fetch("http://127.0.0.1:3000/garage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,color:e})});if(!a.ok)throw new Error("Failed to add car");return a.json()}static async getCar(t){const e=await fetch(`http://127.0.0.1:3000/garage/${t}`);if(!e.ok)throw new Error("Car not found");return await e.json()}static async deleteCar(t){if(!(await fetch(`http://127.0.0.1:3000/garage/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Car not found")}static async switchToDriveMode(t){const e=await fetch(`http://127.0.0.1:3000/engine?id=${t}&status=drive`,{method:"PATCH"});if(!e.ok){const a=await e.text();return 404===e.status?console.error(`Engine parameters for car with id ${t} were not found in the garage. Have you tried to set engine status to "started" before?`):400===e.status?console.error(`Wrong parameters: ${t} should be any positive number, "status" should be "started", "stopped" or "drive"`):429===e.status?console.error("Drive already in progress. You can't run drive for the same car twice while it's not stopped."):500===e.status?console.error("Car has been stopped suddenly. Its engine was broken down."):console.error(`Failed to switch engine to drive mode: ${a}`),Promise.reject(e.status)}return e.status}static async toggleEngine(t,e){const a=await fetch(`http://127.0.0.1:3000/engine/?id=${t}&status=${e}`,{method:"PATCH"});if(!a.ok)throw new Error("Failed to toggle engine");return a.json()}static async updateCar(t,e,a){const n=await fetch(`http://127.0.0.1:3000/garage/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,color:a})});if(!n.ok)throw new Error("Failed to add car");return n.json()}},D=class extends S{constructor(t){super({tagName:"object",className:"",attributes:{}}),this.elem=t}},U=class{constructor(t){this.params={velocity:0,distance:0},this.nextEngineStatus="started",this.isEngineOn=!1,this.btnStartEngine=void 0,this.btnStopEngine=void 0,this.carImage=void 0,this.flagImage=void 0,this.carContainer=void 0,this.isAnimation=!1,this.timeInRace=0,this.winsCount=0,this.id=t.id,this.color=t.color,this.name=t.name,this.carSvgObj=this.createSvg(),this.view=this.createView(),this.componentMap=this.view.getAllChildrenMap()}get Id(){return this.id}set Id(t){this.id=t}get Name(){return this.name}set Name(t){this.name=t}get Color(){return this.color}set Color(t){this.color=t}get Time(){return this.timeInRace}get Wins(){return this.winsCount}incrementWins(){this.winsCount+=1}createSvg(){const t=document.createElement("object");return t.setAttribute("type","image/svg+xml"),t.setAttribute("data",`${F}`),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.onload=()=>{t.contentDocument.getElementById("path3155").setAttribute("fill",`${this.color}`)},new D(t)}select(){const t=new CustomEvent("selectCarEvent",{detail:{selectedCar:this}});document.dispatchEvent(t)}async delete(){try{await B.deleteCar(this.id);const t=new CustomEvent("deleteCarEvent",{detail:{deletedCar:this}});document.dispatchEvent(t)}catch(t){console.error(t)}}async engineSwitch(){this.params=await B.toggleEngine(this.id,this.nextEngineStatus),"started"===this.nextEngineStatus?(this.nextEngineStatus="stopped",this.isEngineOn=!0):"stopped"===this.nextEngineStatus&&(this.nextEngineStatus="started",this.isEngineOn=!1,this.carImage?.addStyle({transform:"translateX(0px)"}),this.btnStartEngine?.deleteAttribute("disabled"),this.btnStopEngine?.setAttributes({disabled:!0}))}async driveMode(){let t;this.isEngineOn||console.error("Need to start engine"),this.isAnimation=!0,await this.animate(),this.btnStartEngine?.setAttributes({disabled:!0});try{t=await B.switchToDriveMode(this.id)}catch(e){return this.isAnimation=!1,Promise.reject(t)}return t}calcContainerRaceWidth(){let t=0;const e=this.carContainer?.getWidth(),a=this.flagImage?.getWidth(),n=this.componentMap.get("car-view__control")?.getWidth()||0,r=this.carImage?.getWidth()||0;return"number"==typeof e&&"number"==typeof a?t=e-a-n-r/2:console.error("Error calculating car container width"),t}animate(){const t=this.calcContainerRaceWidth(),e=performance.now(),a=this.params.distance/this.params.velocity,n=r=>{const i=r-e;if(!this.isAnimation)return void(this.timeInRace=i);const s=i/a*t;this.carImage?.addStyle({transform:`translateX(${s}px)`}),s<t?requestAnimationFrame(n):(this.isAnimation=!1,this.timeInRace=i)};requestAnimationFrame(n)}createView(){this.btnStartEngine=W("btn-start-engine","A",(async()=>{await this.engineSwitch();try{await this.driveMode()}catch(t){console.error(t)}this.btnStopEngine.deleteAttribute("disabled")})),this.btnStopEngine=W("btn-start-drive","B",(async()=>{await this.engineSwitch()})),this.btnStopEngine.setAttributes({disabled:!0}),this.carImage=P("car-image",this.carSvgObj),this.flagImage=P("flag-image",new S({tagName:"img",className:"flag-image",attributes:{src:G,alt:"flag-svg"}},...[])),this.carContainer=P("car-view__draw",this.carImage,this.flagImage);const t=P("car",P("car__nav",W("nav__select-car button-select","Select",(async()=>{await this.select()})),W("nav__remove-car button-remove","Remove",(async()=>{await this.delete()})),I("nav__name-car",`${this.name}`)),P("car-view my-2",P("car-view__control",this.btnStartEngine,this.btnStopEngine),this.carContainer));return t.setAttributes({id:`${this.id}`}),t}},X=()=>{const t={Toyota:["Camry","Corolla","Rav4","Prius","Highlander","Tacoma","Sienna","4Runner","Tundra","C-HR"],Honda:["Accord","Civic","CR-V","Pilot","Odyssey","HR-V","Fit","Insight","Ridgeline","Passport"],Ford:["F-150","Escape","Explorer","Focus","Mustang","Edge","Fusion","Ranger","Expedition","Bronco"],Chevrolet:["Silverado","Equinox","Traverse","Malibu","Tahoe","Suburban","Camaro","Colorado","Blazer","Trax"],Volkswagen:["Jetta","Tiguan","Passat","Atlas","Golf","Arteon","ID.4","Taos","Touareg","Atlas Cross Sport"],Nissan:["Altima","Rogue","Sentra","Murano","Versa","Pathfinder","Maxima","Titan","Kicks","Frontier"],BMW:["3 Series","5 Series","X3","X5","7 Series","X1","4 Series","X7","X6","2 Series"],"Mercedes-Benz":["C-Class","E-Class","GLC","GLE","A-Class","S-Class","CLA","GLB","GLA","GLS"],Audi:["A4","Q5","Q7","A3","Q3","A6","A5","A7","Q8","e-tron"],Tesla:["Model 3","Model Y","Model S","Model X","Cybertruck","Roadster"]},e=Object.keys(t),a=e[Math.floor(Math.random()*e.length)],n=t[a];return`${a} ${n[Math.floor(Math.random()*n.length)]}`},J=class{constructor(){this.carList=void 0,this.title=void 0,this.winnerName=void 0,this.btnStartRace=void 0,this.btnResetRace=void 0,this.carsData=[],this.carsInRace=[],this.carsNumbers=0,this.currentCar=void 0,this.currentPage=1,this.carsPerPage=7,this.carsToCreate=100,this.winnerCar=void 0,this.isRacing=!1,this.deleteCarHandler=()=>{this.updateView()},this.selectCarHandler=t=>{const e=t,{selectedCar:a}=e.detail;this.currentCar=a,this.inputs?.get("color-car")?.setAttributes({value:`${this.currentCar?.Color}`}),this.inputs?.get("name-car")?.setAttributes({value:`${this.currentCar?.Name}`})},this.view=this.createGarageView(),this.view.map?(this.inputs=this.view.map.get("config")?.getAllChildrenMap(),this.carList=this.view.map.get("car-list"),this.title=this.view.map.get("garage-title"),this.updateView(),this.updatePaginationButtons()):console.error("Could not obtain garage view map")}async updateView(){const t=await B.loadGarageData();this.carsInRace=[],this.carsData=t,this.carsNumbers=this.carsData.length;const e=(this.currentPage-1)*this.carsPerPage,a=e+this.carsPerPage,n=this.carsData.slice(e,a);this.title&&this.title.setTextContent(`Garage ${this.carsNumbers}`),this.carList?.deleteChildren(),this.drawCars(n),this.updatePaginationButtons()}updatePaginationButtons(){const t=Math.ceil(this.carsData.length/this.carsPerPage),e=W("prev-page","Prev",(async()=>{this.currentPage>1&&(this.currentPage-=1,await this.updateView())})),a=W("next-page","Next",(async()=>{this.currentPage<t&&(this.currentPage+=1,await this.updateView())})),n=I("pages-info",`${this.currentPage} / ${t}`),r=this.view.map?.get("pagination-container");r?.deleteChildren(),r?.appendChildren([e,n,a])}drawCars(t){t.forEach((t=>{const e=new U(t);this.carList?.append(e.view),this.carsInRace.push(e)}))}async handleAddCar(){const t=this.inputs?.get("color-car"),e=this.inputs?.get("name-car"),a=t.getValue(),n=e.getValue();t&&e&&this.carList||console.error("error color input is not valid");try{const t=await B.addCar(n,a);if(this.carsNumbers<=this.carsPerPage){const e=new U(t).createView();this.carList&&this.carList.append(e)}}catch(t){console.error("Error creating car:",t)}await this.updateView()}async handleUpdateCar(){const t=this.inputs?.get("color-car"),e=this.inputs?.get("name-car"),a=t.getValue(),n=e.getValue();if(t&&e&&this.carList&&this.currentCar){try{await B.updateCar(this.currentCar.id,n,a)}catch(t){console.error("Error update car:",t)}await this.updateView()}else console.error("error color input is not valid")}async createRandomCars(){const t=[];for(let e=0;e<this.carsToCreate;e+=1){const e={color:`#${Math.floor(256*Math.random()).toString(16).padStart(2,"0")}${Math.floor(256*Math.random()).toString(16).padStart(2,"0")}${Math.floor(256*Math.random()).toString(16).padStart(2,"0")}`,name:X()};t.push(e)}const e=t.map((async t=>{try{await B.addCar(t.name,t.color)}catch(t){console.error("Error creating car:",t)}}));await Promise.all(e),await this.updateView()}async startRace(){this.isRacing=!0,this.updateButton(),this.winnerName?.setTextContent("New Winner is...");try{await Promise.all(this.carsInRace.map((t=>t.engineSwitch())));const t=this.carsInRace.map((t=>t.driveMode().then((e=>({car:t,result:e}))))),{car:e,result:a}=await Promise.any(t);200===a&&(this.winnerCar=e,e.incrementWins(),this.raceEnd(),await Promise.allSettled(t))}catch(t){console.error("Error during the race:",t)}finally{this.isRacing=!1,this.updateButton()}}async resetRace(){await Promise.all(this.carsInRace.map((t=>t.engineSwitch()))),this.updateButton(!0)}updateButton(t=!1){this.isRacing?this.btnStartRace?.setAttributes({disabled:!0}):this.btnResetRace?.deleteAttribute("disabled"),t&&(this.btnStartRace?.deleteAttribute("disabled"),this.btnResetRace?.setAttributes({disabled:!0}))}raceEnd(){if(this.winnerName?.setTextContent(`Car ${this.winnerCar?.Name} wins the race!!!`),this.winnerCar){const t=new CustomEvent("endRaceEvent",{detail:{winnerCar:this.winnerCar}});document.dispatchEvent(t)}}createGarageView(){this.winnerName=I("winner-name"," "),this.btnStartRace=W("start-race","Start Race",(async()=>{await this.startRace()})),this.btnResetRace=W("reset-race","Reset Race",(async()=>{await this.resetRace()})),this.btnResetRace?.setAttributes({disabled:!0});const t=P("garage-container",P("config",$("color-car","color"),$("name-car","text","add car name"),W("add-car","Add Car",(async()=>{await this.handleAddCar()})),W("update-car","Update selected",(async()=>{await this.handleUpdateCar()})),W("generate-car","Add 100 cars",(async()=>{await this.createRandomCars()})),this.btnStartRace,this.btnResetRace,this.winnerName),P("garage",M("garage-title",`Garage ${this.carsNumbers}`),P("car-list")),P("pagination-container"));return{element:t,map:t.getAllChildrenMap()}}};var q=a(3),Q={};Q.styleTagTransform=g(),Q.setAttributes=h(),Q.insert=l().bind(null,"head"),Q.domAPI=o(),Q.insertStyleElement=m(),i()(q.A,Q),q.A&&q.A.locals&&q.A.locals;const z=class{static async getWinners(){try{const t=await fetch("http://localhost:3000/winners");if(!t.ok)throw new Error("Failed to fetch winners");return await t.json()}catch(t){throw console.error(t),t}}static async getWinner(t){try{const e=await fetch(`http://localhost:3000/winners/${t}`);if(!e.ok)throw new Error("Failed to fetch winner");return await e.json()}catch(t){return console.error("Error fetching winner:",t),null}}static async createWinner(t){try{const e=await fetch("http://localhost:3000/winners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("failed to create winner");return await e.json()}catch(t){return console.error("error create winner:",t),null}}static async deleteWinner(t){try{if(!(await fetch(`http://localhost:3000/winners/${t}`,{method:"DELETE"})).ok)throw new Error("failed to delete winner");return!0}catch(t){return console.error("error delete winner:",t),!1}}static async updateWinner(t,e){try{const a=await fetch(`http://localhost:3000/winners/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw new Error("failed to update winner");return await a.json()}catch(t){return console.error("error update winner:",t),null}}},Y=t=>Number((t/1e3).toFixed(2));var K;class Z{constructor(){this.table=void 0,this.view=this.createView(),this.updateView()}static async setWinner(t){const e=await z.getWinner(t.Id);if(e){const a=e.wins+t.Wins,n=e.time>Y(t.Time)?e.time:Y(t.Time);await z.updateWinner(t.Id,{wins:a,time:n})}else await z.createWinner({id:t.Id,wins:t.Wins,time:Y(t.Time)})}async updateView(){this.table?.deleteChildren();const t=await z.getWinners(),e=await Promise.all(t.map((async t=>K.drawWinner(t))));this.table?.appendChildren(e)}static async drawWinner(t){const{id:e,wins:a,time:n}=t,r=L("");if(!e)return r;const i=await B.getCar(e),s=new U(i);return L("table-elem",V("table-elem__number",`${e}`),V("table-elem__image","",P("",s.carSvgObj)),V("table-elem__name",`${i.name}`),V("table-elem__wins-count",`${a}`),V("table-elem__best-time",`${n}`))}createView(){this.table=new S({tagName:"tbody"},...[]);const t=P("winners-container",M("winners-title","Winners"),((t,...e)=>new S({tagName:"table",className:t},...e))("table table-warning table-striped winners-table",((...t)=>new S({tagName:"thead"},...t))(L("",j("table-title","№",""),j("table-title","Image",""),j("table-title","Name",""),j("table-title","Wins",""),j("table-title","Time, sec",""))),this.table));return{element:t,map:t.getAllChildrenMap()}}}K=Z,Z.deleteWinnerHandler=async t=>{const e=t,{deletedCar:a}=e.detail;await z.getWinner(a.id)&&await z.deleteWinner(a.id)},Z.endRaceHandler=async t=>{const e=t,{winnerCar:a}=e.detail;await K.setWinner(a)};const tt=Z,et=class{constructor(){this.root=document.querySelector("#root"),this.mainPageView=(()=>{const t=P("container-fluid p-0 app-container",P("app-content",((t,...e)=>new S({tagName:"nav",className:t},...e))("app-nav navbar justify-content-start mx-2",M("app-title flex-grow-1","Async-race"),W("btn-winners mx-2","To Winners",(()=>{})),W("btn-garage mx-2","To Garage",(()=>{}))),P("main")));return{element:t.getElement(),map:t.getAllChildrenMap()}})(),this.mainContainer=this.mainPageView.map.get("main"),this.buttonGarage=this.mainPageView.map.get("btn-garage"),this.buttonWinners=this.mainPageView.map.get("btn-winners"),this.garage=new J,this.winners=new tt}renderGarage(){this.mainContainer?(this.mainContainer.deleteChildren(),this.garage=new J,this.mainContainer.append(this.garage.view.element)):console.error("Garage container not found")}renderWinners(){this.mainContainer?(this.mainContainer.deleteChildren(),this.winners=new tt,this.mainContainer.append(this.winners.view.element)):console.error("Garage container not found")}clearRoot(){if(this.root)for(;this.root.firstChild;)this.root.removeChild(this.root.firstChild);else console.error("dont find root")}start(){this.root?(this.root.append(this.mainPageView.element),this.renderGarage(),this.buttonGarage?.addListener("click",(()=>this.renderGarage())),this.buttonWinners?.addListener("click",(()=>this.renderWinners())),this.setupObserver()):console.error("dont find root")}setupObserver(){document.addEventListener("deleteCarEvent",(t=>{this.garage.deleteCarHandler(),tt.deleteWinnerHandler(t)})),document.addEventListener("selectCarEvent",this.garage.selectCarHandler),document.addEventListener("endRaceEvent",tt.endRaceHandler)}};class at{constructor(){at.app=this,this.manager=new et}start(){this.manager.start()}static getApplication(){return at.app}}(new at).start()})()})();